@using PIA.Entities;
@{
    ViewBag.Title = "Nueva Propiedad";
    Layout = "~/Views/Shared/_Layout.cshtml";
    List<TiposInmueble> tiposInmueble = ViewBag.TiposInmueble;
    List<Operaciones> operaciones = ViewBag.Operaciones;
    List<Estados> estados = ViewBag.Estados;
    List<Caracteristicas> caracteristicas = ViewBag.Caracteristicas;
}
<div class="container">
    <form>
        <div class="col-md-12">
            <h4>Características</h4>
            <hr />
        </div>
        <div class="col-md-6">
            @foreach(var destacada in caracteristicas.Where(x => x.Destacado))
            {
                <div class="form-group">
                    <label class="control-label">@destacada.Descripcion</label>
                    <input type="@destacada.Tipo" name="@destacada.Descripcion" class="form-control caracteristica" required />
                </div>
            }
        </div>
        <div class="col-md-12">
            <h4>Ubicación</h4>
            <hr />
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label class="control-label">Tipo de Inmueble</label>
                <select name="IdTipoInmueble" id="IdTipoInmueble" class="form-control">
                    @foreach(var tipo in tiposInmueble)
                    {
                        <option value="@tipo.IdTipoInmueble">@tipo.Descripcion</option>
                    }
                </select>
            </div>
            <div class="form-group">
                <label class="control-label">Calle</label>
                <input type="text" name="Calle" id="Calle" class="form-control" />
            </div>
            <div class="form-group">
                <label for="Colonia" class="control-label">Colonia</label>
                <input type="text" name="Colonia" id="Colonia" class="form-control" />
            </div>
            <div class="form-group">
                <label for="NumExterior" class="control-label">Número Exterior</label>
                <input type="text" name="NumExterior" id="NumExterior" class="form-control" />
            </div>
            <div class="form-group">
                <label for="NumInterior" class="control-label">Número Interior</label>
                <input type="text" name="NumInterior" id="NumInterior" class="form-control" />
            </div>
            <div class="form-group">
                <label for="IdMunicipio" class="control-label">Municipio</label>
                <select name="IdMunicipio" id="IdMunicipio" class="form-control">
                    @foreach(var estado in estados)
                    {
                        <optgroup label="@estado.Nombre">
                            @foreach(var municipio in estado.Municipios)
                            {
                                <option value="@municipio.IdMunicipio">@municipio.Nombre</option>
                            }
                        </optgroup>
                    }
                </select>
            </div>

        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label class="control-label">Ubicación</label>
                <div id="map" style="width: 100%; height: 300px;"></div>
            </div>
        </div>
        <div class="col-md-12">
            <h4>Datos de Publicación</h4>
            <hr />
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label class="control-label">Operación</label>
                <select name="IdOperacion" id="IdOperacion" class="form-control">
                    @foreach(var operacion in operaciones)
                    {
                        <option value="@operacion.IdOperacion">@operacion.Descripcion</option>
                    }
                </select>
            </div>
            <div class="form-group">
                <label class="control-label">Título</label>
                <input type="text" name="Titulo" id="Titulo" class="form-control" />
            </div>
            <div class="form-group">
                <label class="control-label">Precio</label>
                <input type="text" name="Precio" id="Precio"  class="form-control" />
            </div>
            <div class="form-group">
                <input type="submit" class="btn btn-block btn-primary" />
            </div>
        </div>
    
    </form>
</div>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAbQdGSuyDBFobghsn1rMOl0PuzjJZ7xpU&callback=initMap">
</script>
<script type="text/javascript">
    function initMap() {
        var myLatlng = new google.maps.LatLng(21.1901853, -86.8198375);
        var mapOptions = {
            zoom: 10,
            center: myLatlng
        }
        var map = new google.maps.Map(document.getElementById("map"), mapOptions);

        // Place a draggable marker on the map
        

        // Try HTML5 geolocation.
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function (position) {
                var pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

                map.setCenter(pos);
                map.setZoom(15);

                var marker = new google.maps.Marker({
                    position: pos,
                    map: map,
                    draggable: true,
                    title: "Seleccionar la ubicación"
                });
            }, function () {
                handleLocationError(true, infoWindow, map.getCenter());
            });
        } else {
            // Browser doesn't support Geolocation
            handleLocationError(false, infoWindow, map.getCenter());
        }
    }

    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                              'Error: The Geolocation service failed.' :
                              'Error: Your browser doesn\'t support geolocation.');
    }
</script>